syntax = "proto3";

package proto.v1;

import "buf/validate/validate.proto";
import "google/protobuf/timestamp.proto";

// https://buf.build/bufbuild/protovalidate/docs/main:buf.validate#buf.validate.Violation

message GreetMsg {
  string id = 1 [ (buf.validate.field).string.uuid = true ];
  string uri = 2 [ (buf.validate.field).string.uri = true ];
}

message Peer {
  string id = 1 [ (buf.validate.field).string.uuid = true ];
  string uri = 2 [ (buf.validate.field).string.uri = true ];
  uint64 counter = 3 [ (buf.validate.field).required = true ];
  bool dead = 5;

  google.protobuf.Timestamp lastseen = 4
      [ (buf.validate.field).required = true ];
}

message GossipMsg {
  // these are values of the resp-er
  string id = 1 [ (buf.validate.field).string.uuid = true ];
  string uri = 2 [ (buf.validate.field).string.uri = true ];
  uint64 counter = 3 [ (buf.validate.field).required = true ];
  bool dead = 5;
  // we dont send our own timestamp, req-er will fill in with local clock
  repeated Peer peers = 4;
}

service ClusterService {
  rpc Greet(GreetMsg) returns (GreetMsg) {}
  rpc Gossip(GossipMsg) returns (GossipMsg) {}
}
